set -g prefix C-e

bind-key "K" run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 55%,60% \
    --ansi \
    --no-sort --prompt '> ' \
    --color 'bg:#282828,bg+:#3c3836,fg:#89b4fa,fg+:#89b4fa' \
    --color 'hl:#fabd2f,hl+:#fabd2f,info:#83a598,marker:#8ec07c' \
    --color 'prompt:#d79921,spinner:#8ec07c,pointer:#fe8019,header:#928374' \
    --color 'border:#928374,label:#ebdbb2,query:#ebdbb2'
)\""


# colors
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g cursor-style blinking-bar

# Basic
set -g base-index 1
set -g pane-base-index 1
set -g detach-on-destroy off
set -g escape-time 0
set -g focus-events on
set -g history-limit 20000
set -g mouse on
set -g renumber-windows on
set -g set-clipboard on
set -g aggressive-resize on

# Enable extended keys for proper modifier key support
set -g extended-keys on
set -as terminal-features 'xterm*:extkeys'

# Vim mode
# enter with <leader>[
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel 'pbcopy'

# key binding
bind - split-window -c '#{pane_current_path}'
bind | split-window -h -c '#{pane_current_path}'
bind-key z command-prompt -I '#S' 'rename-session '%%''
bind-key r command-prompt -I '#W' 'rename-window '%%''
bind-key l resize-pane -x 40%
bind-key h resize-pane -x 60%
bind-key -n Home send Escape 'OH'
bind-key -n End send Escape 'OF'
bind-key o split-window -h -p 65 "echo -n $(date +%Y-%m-%d-) | pbcopy && cd $OBSIDIAN_VAULT && nvim"

# Don't confirm before save
bind-key & kill-window
bind-key x kill-pane

# Theme
set -g status-position top
set -g status-left-length 50

set -g @custom_bg '#282828'
set -g @custom_fg '#ebdbb2'
set -g @custom_gray '#928374'
set -g @custom_dark_gray '#3c3836'
set -g @custom_red '#fb4934'
set -g @custom_yellow '#fabd2f'
set -g @custom_orange '#d79921'
set -g @custom_lavender '#b4befe'
set -g @custom_surface '#504945'

# Status bar
set -g status-style "bg=default,fg=#{@custom_fg}"
set -g status-right-length 100
set -g status-left "#[fg=#{?client_prefix,#{@custom_red},#{@custom_orange}},bg=#{@custom_bg}][#S] "
set -g status-right "#[fg=#{@custom_yellow},bg=#{@custom_bg}] %Y-%m-%d %H:%M "

# Window status
set -g window-status-format "#[fg=#{@custom_gray},bg=default] #I #[fg=#{@custom_fg},bg=default]#W "
set -g window-status-current-format "#[fg=#{@custom_bg},bg=#{@custom_lavender}] #I:#W "

# Pane borders
set -g pane-border-style "fg=#{@custom_surface}"
set -g pane-active-border-style "fg=#{@custom_lavender}"

# Selection style
set -g mode-style "bg=#{@custom_surface},fg=#{@custom_fg}"

# Messages
set -g message-style "bg=#{@custom_dark_gray},fg=#{@custom_yellow}"
set -g message-command-style "bg=#{@custom_dark_gray},fg=#{@custom_yellow}"

# vim-tmux-navigator: seamless navigation between vim and tmux
# Source: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
bind-key -n 'C-\' if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
bind-key 'C-l' send-keys 'C-l'

# tmux-fzf-url: extract URLs from pane and open with fzf
# Source: https://github.com/joshmedeski/tmux-fzf-url
bind-key u run-shell -b 'tmux capture-pane -J -p | grep -oE "(https?|ftp|file):/?//[-A-Za-z0-9+&@#/%?=~_|!:,.;]*[-A-Za-z0-9+&@#/%=~_|]" | sort -u | fzf-tmux -d 35% -m --no-preview --no-border | xargs open'

